<!DOCTYPE html>
<html lang='en'>
  <head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> 
    {{#if pageTitle }}
    {{ pageTitle }} || Storybook 
    {{ else}}
     Storybook 
    {{/if}}
    </title>
    
    <link rel="shortcut icon" href="/img/storybook.png" />
    
    <link rel="stylesheet" href="/bootstrap-4.3.1/css/bootstrap-4.3.1.min.css" />
      <link rel="stylesheet" href="/fontawesome-free-5.8.2-web/css/all.css">
      <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/eruda.min.js"></script>
    <script>eruda.init();</script>
    <script src="/js/eruda-code.min.js"></script>
    <script>eruda.add(erudaCode)</script>
    <script src="/js/eruda-dom.min.js"></script>
    <script>eruda.add(erudaDom)</script>
    <!-- ckeditor basic-->
  <script src="//cdn.ckeditor.com/4.12.1/standard/ckeditor.js"></script>
    
  </head>
  <body>
   <!-- navbar partials -->
    {{> _navbar }}
    {{> _msg }}
    {{> _errors }}
   
   
    {{{body}}}
    
    
   {{> _footer }}
   
   
   <!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="/bootstrap-4.3.1/js/jquery-3.4.1.min.js" type="text/javascript"></script>

  <script src="/bootstrap-4.3.1/js/popper.min.js" type="text/javascript"></script>
  <script src="/bootstrap-4.3.1/js/bootstrap-4.3.1.min.js" type="text/javascript"></script>
   
   <script src="/bootstrap-4.3.1/js/bs-custom-file-input.min.js" type="text/javascript"></script>
    <!-- axios -->
    <!--script src="https://unpkg.com/axios/dist/axios.min.js"></script-->
     <script src="/bootstrap-4.3.1/js/axios.min.js" type="text/javascript"></script>
   <!-- main js -->
  <script src="/js/main.js"></script>
  
  <script>
    $(  function(){
      console.log('onload')
      
      const url = 'http://jsonplaceholder.typicode.com/todos/1';
      
      
    $('form #file').on('change', async function(e) {
      const form = new FormData();
      const file = $('#file')[0].files[0];
     // const file = 'data file';
     
     
     form.append('avatar', file, file.name);
    
      console.log('on change', file.name, file.type, );
      // return;
      let url = '';
      
      url = '/uploads';
     
      const res = await axios.get(url, {
        params: {
          filename: file.name, 
          type: file.type,
          }
        });
        
        const img = $('#profile-img');
        console.log('res url', res, 'attr', img.attr('src'));
      return;
      
      
     // url = '/xyz/abu';
      url = 'http://localhost:5000/xyz/upload';
      url = '/xyz/abu';
      
      axios.put(url, form, { 
        //method: 'put', 
       // url, //: '/user/12345', 
       // data: file,
        headers: {
           'Content-Type': 'multipart/form-data',  
           //'Content-Type': 'image/*' , 
           },
      })
      .then(async res => {
        console.log('axios res:', res,);
        const { data, url} = res.data;
        
        
        // send to gcs
        const result = await axios.put(
        url, 
        file, 
        {
          headers: {'Content-Type': file.type,
           //"Access-Control-Allow-Origin": "*", 
           //'Accept': '*',
           
          }, 
        })
        .catch(err => {
     console.log('err gcp', err);
   });
   
   console.log('result', result);
   
       /* $.ajax(url, data, (data, status) => {
          console.log('data', data, 'status', status);
        });*/
        
       /* $.ajax({
        method: "PUT",
        url,
        data,
        //processData: false,
        //contentType: 'application/x-www-form-urlencoded',
        headers: {'Content-Type': file.type},
    })
    .then(function(msg) {
        console.log("Data Saved: ", msg);
    })
    .catch(err => {
      console.log("Error: ", err);
    });*/
        
        
      })
      .catch(err => {
        console.log('err getPresignedUrl:', err)
      });
      
      
      
      /*$.ajax({
        method: "PUT",
        url,
        data,
        //processData: false,
        //contentType: 'application/x-www-form-urlencoded',
        headers: {'Content-Type': 'application/json'},
    })
    .then(function(msg) {
        console.log("Data Saved: ", msg);
    })
    .catch(err => {
      console.log("Error: ", err);
    });*/
      
      
      /*
      const res = await $.ajax({ 
        url, 
        method: 'put', 
        data: file, //{name: 'abu', age: 'lulu', file},
        processData: false,
        contentType: false,
      })
     
      .catch(console.error);
      
      console.log('await res', res);
      */
      
      /*$.ajax({
        url,
        data: file,
        method: 'POST',
       // contentType: false,
       // processData: false,
        //headers: {contentType: ''},
        success(res) {
          console.log('success 0ne', res);
        },
        error(err) {
          console.log('err', JSON.stringify(err));
        }
      }); // end $.ajax*/
    }); // end submit
    }); // onload
  </script>
  </body>
</html>